<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Snail Colony Server</title>
    <style>
      body { font-family: sans-serif; margin: 20px; }
      button { margin-right: 5px; }
      #logs { display: flex; gap: 10px; margin-top: 20px; }
      .log-col { flex: 1; background: #f5f5f5; border: 1px solid #ccc; padding: 5px; height: 150px; overflow: auto; }
      .log-col h3 { margin-top: 0; }
    </style>
</head>
<body>
  <h1>Snail Colony Server</h1>
  <div>
    <button id="refreshBtn">Refresh Lobby</button>
  </div>
  <h2>Players</h2>
  <ul id="players"></ul>
  <div id="logs">
    <div class="log-col">
      <h3>IN</h3>
      <div id="inLogs"></div>
    </div>
    <div class="log-col">
      <h3>OUT</h3>
      <div id="outLogs"></div>
    </div>
    <div class="log-col">
      <h3>System</h3>
      <div id="sysLogs"></div>
    </div>
  </div>
  <script>
    const inLogs = document.getElementById('inLogs');
    const outLogs = document.getElementById('outLogs');
    const sysLogs = document.getElementById('sysLogs');
    const playersList = document.getElementById('players');

    function log(el, msg) {
      const line = document.createElement('div');
      const time = new Date().toLocaleTimeString();
      line.textContent = `[${time}] ${msg}`;
      el.appendChild(line);
      el.scrollTop = el.scrollHeight;
    }

    async function refresh() {
      log(outLogs, 'GET /lobby/rooms');
      const res = await fetch('/lobby/rooms');
      const data = await res.json();
      playersList.innerHTML = '';
      for (const p of data.players) {
        const li = document.createElement('li');
        li.textContent = p;
        playersList.appendChild(li);
      }
    }

    document.getElementById('refreshBtn').onclick = refresh;
    refresh();

    const ws = new WebSocket(`ws://${location.host}/ws`);
    ws.onopen = () => log(sysLogs, 'WebSocket connected');
    ws.onclose = () => log(sysLogs, 'WebSocket closed');
    ws.onerror = () => log(sysLogs, 'WebSocket error');
    ws.onmessage = (ev) => {
      try {
        const msg = JSON.parse(ev.data);
        if (msg.t === 'Log' && msg.dir === 'IN') {
          log(inLogs, msg.msg);
        }
      } catch {}
    };
  </script>
</body>
</html>
